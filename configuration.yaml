homeassistant:
  # Name of the location where Home Assistant is running
  name: Home
  # Location required to calculate the time the sun rises and sets
  latitude: !secret home_latitude
  longitude: !secret home_longitude
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: 37
  # metric for Metric, imperial for Imperial
  unit_system: imperial
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: America/New_York
  customize: !include customize.yaml

# Enables the frontend
frontend:

http:
  api_password: !secret hass_api_password
  ip_ban_enabled: True
  login_attempts_threshold: 5

# Checks for available updates
updater:

# database for history
recorder:
  # db_url: !secret db_url
  exclude:
    entities:
      - sensor.ram_use
      - sensor.since_last_boot
      - sensor.last_boot
      - sensor.disk_use_
      - sensor.cpu_use
      - sun.sun

# Discover some devices automatically
discovery:
  ignore:
    - netgear_router

# Allows you to issue voice commands from the frontend in enabled browsers
conversation:

# Enables support for tracking state changes over time.
history:

# View all events in a logbook
logbook:

# Track the sun
sun:

# amcrest:
#   - host: 192.168.15.190
#     username: admin
#     password: !secret armcrest_password
#     sensors:
#       - motion_detector
#
# camera:
#   - platform: amcrest

device_tracker:
  - platform: netgear
    host: !secret netgear_host
    username: !secret netgear_user
    password: !secret netgear_password
    port: !secret netgear_port
    interval_seconds: 30
    consider_home: 60
    new_device_defaults:
      track_new_devices: False

ifttt:
  key: !secret ifttt_key

binary_sensor:
  - platform: command_line
    command: curl http://192.168.15.100:8888/api/cal
    name: David Meeting
    device_class: occupancy
    payload_on: True
    payload_off: False

google_assistant:
  project_id: !secret ga_project_id
  client_id: !secret ga_client_id
  access_token: !secret ga_access_token

# no longer have this thermostat
# lyric:
#   client_id: !secret honeywell_key
#   client_secret: !secret honeywell_secret

cast:
  media_player:
  - host: 192.168.15.205

sensor:
  - platform: darksky
    api_key: !secret dark_sky_key
    monitored_conditions:
      - summary
      - temperature
      - temperature_max
      - temperature_min
      - apparent_temperature
      - wind_speed
      - humidity
      - cloud_cover
      - precip_probability
  - platform: pi_hole
    host: 192.168.15.202
    monitored_conditions:
      - ads_percentage_today
      - dns_queries_today
  - platform: template
    sensors:
      garage_door_status:
        value_template: '{{ states.cover.door_control.state }}'
        friendly_name: 'Door Status'
      david_meeting_status:
        value_template: '{% if is_state("binary_sensor.david_meeting", "on") %}In Meeting{% else %}Free{% endif %}'
        friendly_name: David Status
      printer_status:
        value_template: "{% if states.device_tracker.canone3a1e9 %}
        {% if is_state('device_tracker.canone3a1e9', 'home') %}
          Online
        {% else %}
          Offline
        {% endif %}
        {% else %}
          Unknown
        {% endif %}"
        friendly_name: Printer
      circle_status:
        value_template: "{% if states.device_tracker.circle %}
        {% if is_state('device_tracker.circle', 'home') %}
          Online
        {% else %}
          Offline
        {% endif %}
        {% else %}
          Unknown
        {% endif %}"
        friendly_name: Circle
      pollen_rating_today:
        value_template: "{{ states.sensor.allergy_index_today.attributes.rating}}"
        friendly_name: Pollen Level Today
      pollen_today_source:
        value_template: "{{ states.sensor.allergy_index_today.attributes.primary_allergen_name_1}}"
        friendly_name: Pollen Primary Source

  - platform: speedtest
    minute:
      - 0
      - 30
    monitored_conditions:
      - ping
      - download
      - upload
  - platform: systemmonitor
    resources:
      - type: disk_use_percent
        arg: /
      - type: memory_use_percent
      - type: processor_use
      - type: last_boot
      - type: since_last_boot
  - platform: airvisual
    api_key: !secret airvisual_api_key
    monitored_conditions:
      - us
  - platform: pollen
    zip_code: !secret zip_code
    monitored_conditions:
     - allergy_index_today
     - allergy_index_tomorrow
#
# usps:
#   username: !secret usps_username
#   password: !secret usps_password


# Test Garage control
cover:
- platform: command_line
  covers:
    garage_door:
      command_open: curl --data '' 192.168.15.100:8888/api
      command_close: curl --data '' 192.168.15.100:8888/api
      command_stop: curl --data '' 192.168.15.100:8888/api
      command_state: curl 192.168.15.100:8888/api
      friendly_name: Door Control

telegram_bot:
  platform: polling
  api_key: !secret telegram_key
  allowed_chat_ids:
    - !secret telegram_chat_id

notify:
 - name: halladay_bot
   platform: telegram
   chat_id: !secret telegram_chat_id

mqtt:
  broker: !secret mqtt_broker
  port: !secret mqtt_port
  username: !secret mqtt_user
  password: !secret mqtt_password

wemo:
  static:
    - 192.168.15.155
    - 192.168.15.156

amcrest:
  - host: 192.168.15.190
    name: Garage
    username: admin
    password: !secret armcrest_password
    resolution: low
    stream_source: snapshot
    sensors:
      - motion_detector

google:
  client_id: !secret google_client_id
  client_secret: !secret google_client_secret

camera:
  - platform: generic
    name: Weather Radar
    still_image_url: !secret weather_radar_url

automation:
  - alias: Notify David if garage is opened
    trigger:
      platform: state
      entity_id: cover.door_control
      from: 'closed'
      to: 'open'
      for:
        hours: 0
        minutes: 0
        seconds: 45
    condition:
      condition: state
      entity_id: group.family
      state: 'not_home'
    action:
      - service: notify.halladay_bot
        data:
          message: The garage has been opened with nobody home.
  - alias: Notify David if garage is left open
    trigger:
      platform: state
      entity_id: group.family
      from: 'home'
      to: 'not_home'
    condition:
      condition: state
      entity_id: cover.door_control
      state: 'open'
    action:
      - service: notify.halladay_bot
        data:
          message: 'The garage has been left open!'
  - alias: Toggle Office Sign On for Meeting
    trigger:
      platform: state
      entity_id: sensor.david_meeting_status
      from: 'Free'
      to: 'In Meeting'
    action:
      - service: switch.turn_on
        entity_id: switch.office_sign
  - alias: Toggle Office Sign Off for Free
    trigger:
      platform: state
      entity_id: sensor.david_meeting_status
      from: 'In Meeting'
      to: 'Free'
    action:
      - service: switch.turn_off
        entity_id: switch.office_sign
group: !include groups.yaml
